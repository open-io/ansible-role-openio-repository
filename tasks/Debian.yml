---
- name: "Configure Backports repository for {{ ansible_lsb.id }} {{ ansible_distribution_release }}"
  apt_repository:
    repo: "deb http://httpredir.debian.org/debian/ {{ ansible_distribution_release }}-backports main contrib non-free"
    state: present
    filename: "{{ ansible_distribution_release }}-backports"
  when: ansible_lsb.id == 'Debian'

- name: "Configure {{ openio_sds_repo_product }} repository for {{ ansible_lsb.id }} {{ ansible_distribution_release }}"
  apt_repository:
    repo: "deb {{ openio_sds_repo_releaseurl }}/{{ ansible_lsb.id }}/ {{ ansible_distribution_release }}/"
    state: present
    filename: openio-sds

- name: "Setup repository key"
  apt_key:
    id: 51DB6A8D
    url: "{{ openio_sds_repo_baseurl }}/APT-GPG-KEY-OPENIO-0"
    state: present

- name: "Install required packages to configure repositories"
  package:
    name: "{{ pkg }}"
    state: present
  with_items:
    - python-software-properties
    - python3-software-properties
  loop_control:
    loop_var: pkg
  when: ansible_lsb.id == 'Ubuntu'

- name: "Configure Openstack {{ openio_openstack_release }} release repository"
  apt_repository:
    repo: "deb http://ubuntu-cloud.archive.canonical.com/ubuntu {{ ansible_lsb.codename }}-updates/pike main"
    state: present
    filename: 'cloudarchive-pike'
  when: ansible_lsb.id == 'Ubuntu'

- name: "Setup repository key for Openstack repository"
  apt_key:
    id: 5EDB1B62EC4926EA
    keyserver: keyserver.ubuntu.com

- name: "Update APT cache"
  apt:
    update_cache: yes
  changed_when: false

- name: Configure policy to disable starting services at package install
  template:
    src: policy-rc.d
    dest: /usr/sbin/policy-rc.d
    owner: root
    group: root
    mode: 0755
  when:
    - openio_policy_disable_autostart
...
